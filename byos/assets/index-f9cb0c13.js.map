{"version":3,"file":"index-f9cb0c13.js","sources":["../../raw_code/byos/src/script.js"],"sourcesContent":["var id = document.getElementById(\"drawflow\");\r\nconst editor = new Drawflow(id);\r\nvar audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\neditor.reroute = true;\r\neditor.start();\r\n\r\n// Events!\r\nconst audioNodes = new Map();\r\nconst stateString = \"synth\";\r\n\r\nasync function compress(str) {\r\n  // Convert the string to a byte stream.\r\n  const stream = new Blob([str]).stream();\r\n\r\n  // Create a compressed stream.\r\n  const compressedStream = stream.pipeThrough(new CompressionStream(\"gzip\"));\r\n\r\n  // Read all the bytes from this stream.\r\n  const chunks = [];\r\n  for await (const chunk of compressedStream) {\r\n    chunks.push(chunk);\r\n  }\r\n  return await concatUint8Arrays(chunks);\r\n}\r\n\r\nasync function decompress(compressedBytes) {\r\n  // Convert the bytes to a stream.\r\n  const stream = new Blob([compressedBytes]).stream();\r\n\r\n  // Create a decompressed stream.\r\n  const decompressedStream = stream.pipeThrough(\r\n    new DecompressionStream(\"gzip\")\r\n  );\r\n\r\n  // Read all the bytes from this stream.\r\n  const chunks = [];\r\n  for await (const chunk of decompressedStream) {\r\n    chunks.push(chunk);\r\n  }\r\n  const stringBytes = await concatUint8Arrays(chunks);\r\n\r\n  // Convert the bytes to a string.\r\n  return new TextDecoder().decode(stringBytes);\r\n}\r\n\r\nasync function concatUint8Arrays(uint8arrays) {\r\n  const blob = new Blob(uint8arrays);\r\n  const buffer = await blob.arrayBuffer();\r\n  return new Uint8Array(buffer);\r\n}\r\n\r\nfunction toString(data) {\r\n  return JSON.stringify(data);\r\n}\r\n\r\nfunction fromString(str) {\r\n  return str;\r\n}\r\n\r\nasync function encodeToUrl(data) {\r\n  const dataString = toString(data);\r\n  compress(dataString).then((uint8Array) => {\r\n    const base64 = btoa(String.fromCharCode.apply(null, uint8Array));\r\n    const base64UrlSafe = base64.replace(/\\+/g, \"-\").replace(/\\//g, \"_\");\r\n    const url = new URL(window.location.href);\r\n    url.searchParams.set(\"d\", base64UrlSafe);\r\n    window.history.pushState(null, \"\", url.toString());\r\n  });\r\n}\r\n\r\nasync function decodeFromUrl() {\r\n  const urlParams = new URLSearchParams(window.location.search);\r\n  const base64UrlSafe = urlParams.get(\"d\");\r\n  if (!base64UrlSafe) {\r\n    return null;\r\n  }\r\n  let base64 = base64UrlSafe.replace(/-/g, \"+\").replace(/_/g, \"/\");\r\n  let uint8Array = new Uint8Array(\r\n    atob(base64)\r\n      .split(\"\")\r\n      .map((char) => char.charCodeAt(0))\r\n  );\r\n  return decompress(uint8Array).then((str) => {\r\n    return fromString(str);\r\n  });\r\n}\r\n\r\nasync function readData() {\r\n  const urlData = await decodeFromUrl();\r\n  const state = urlData ?? localStorage.getItem(stateString);\r\n  if (state && state != \"undefined\" && state !== null) {\r\n    const { data } = JSON.parse(state).drawflow.Home;\r\n    console.log(\"data\", data);\r\n\r\n    const connectionsMap = {};\r\n    const idMap = {};\r\n    const newIdMap = {};\r\n\r\n    // first identify the network graph\r\n\r\n    for (const [_, value] of Object.entries(data)) {\r\n      const { id, outputs } = value;\r\n      connectionsMap[id] = {};\r\n      for (const [outputName, value] of Object.entries(outputs)) {\r\n        connectionsMap[id][outputName] = [];\r\n        for (let i = 0; i < value.connections.length; i++) {\r\n          const { node, output } = value.connections[i];\r\n          connectionsMap[id][outputName].push({ id: node, inputName: output });\r\n        }\r\n      }\r\n    }\r\n\r\n    // identify sink nodes, then measure distance to sink, and that's the x value\r\n    // then use different y per node\r\n\r\n    const sinkIds = [];\r\n    const distanceToSink = {};\r\n    // identify sink nodes\r\n    for (const [id, connections] of Object.entries(connectionsMap)) {\r\n      if (Object.keys(connections).length === 0) {\r\n        sinkIds.push(id);\r\n        distanceToSink[id] = 0;\r\n      }\r\n    }\r\n\r\n    // measure distance to sink\r\n    var newDist = {};\r\n    while (true) {\r\n      for (const [id, connections] of Object.entries(connectionsMap)) {\r\n        if (id.toString() in distanceToSink) {\r\n          continue;\r\n        }\r\n\r\n        for (const [outputName, connections2] of Object.entries(connections)) {\r\n          for (let i = 0; i < connections2.length; i++) {\r\n            const connection = connections2[i];\r\n            const d = distanceToSink[Number(connection.id)];\r\n            if (d !== undefined) {\r\n              if (newDist[id] !== undefined) {\r\n                newDist[id] = Math.min(newDist[id], d);\r\n              } else {\r\n                newDist[id] = d;\r\n              }\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (Object.keys(newDist).length === 0) {\r\n        break;\r\n      } else {\r\n        for (const [id, d] of Object.entries(newDist)) {\r\n          distanceToSink[id] = d + 1;\r\n        }\r\n        newDist = {};\r\n      }\r\n    }\r\n\r\n    for (const [id, value] of Object.entries(data)) {\r\n      if (distanceToSink[id] === undefined) {\r\n        throw new Error();\r\n      }\r\n    }\r\n\r\n    // calculate positions of nodes\r\n\r\n    const countOfDist = {};\r\n    const position = {};\r\n    for (const [id, value] of Object.entries(data)) {\r\n      const dist = distanceToSink[id];\r\n      if (countOfDist[dist] === undefined) {\r\n        countOfDist[dist] = 1;\r\n      } else {\r\n        countOfDist[dist] = countOfDist[dist] + 1;\r\n      }\r\n      const count = countOfDist[dist];\r\n\r\n      position[id] = { posX: -dist * 300 + 800, posY: 500 * count };\r\n    }\r\n\r\n    // then figure out which positions to put nodes in and create the nodes\r\n\r\n    for (const [_, value] of Object.entries(data)) {\r\n      const { id, name, data } = value;\r\n\r\n      const newId = addNodeToDrawFlow(\r\n        name,\r\n        position[id].posX,\r\n        position[id].posY,\r\n        data\r\n      );\r\n\r\n      console.log(data);\r\n      audioNodes[newId].updateData(data);\r\n\r\n      idMap[id] = newId;\r\n      newIdMap[newId] = id;\r\n    }\r\n    // then connect the nodes\r\n    for (const [id, connections] of Object.entries(connectionsMap)) {\r\n      for (const [outputName, connectionList] of Object.entries(connections)) {\r\n        for (let i = 0; i < connectionList.length; i++) {\r\n          const inputId = connectionList[i].id;\r\n          const inputName = connectionList[i].inputName;\r\n          editor.addConnection(\r\n            idMap[id],\r\n            idMap[inputId],\r\n            outputName,\r\n            inputName\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n  await encodeToUrl(editor.export());\r\n}\r\n\r\nasync function saveData() {\r\n  const data = editor.export();\r\n  localStorage.setItem(stateString, JSON.stringify(data));\r\n  await encodeToUrl(data);\r\n}\r\n\r\nfunction draw() {\r\n  audioContext.resume();\r\n  const timestamp = Date.now();\r\n  for (const [_, audioNode] of Object.entries(audioNodes)) {\r\n    const canvas = audioNode.canvas;\r\n    const analyser = audioNode.analyser;\r\n    if (canvas && analyser) {\r\n      const canvasCtx = canvas.getContext(\"2d\");\r\n      const bufferLength = analyser.frequencyBinCount;\r\n      const dataArray = new Uint8Array(bufferLength);\r\n      analyser.getByteTimeDomainData(dataArray);\r\n\r\n      audioNode.history.push([timestamp, dataArray]);\r\n\r\n      const windowSize = 500;\r\n\r\n      audioNode.history = audioNode.history.filter(\r\n        ([time, _]) => time > timestamp - windowSize\r\n      );\r\n\r\n      const bufferTimeLength =\r\n        (1000 * analyser.frequencyBinCount) / audioContext.sampleRate;\r\n      const sampleTick = bufferTimeLength / analyser.frequencyBinCount;\r\n\r\n      canvasCtx.clearRect(0, 0, canvas.width, canvas.height);\r\n      canvasCtx.fillStyle = \"rgb(200 200 200)\";\r\n      canvasCtx.fillRect(0, 0, canvas.width, canvas.height);\r\n      canvasCtx.lineWidth = 2;\r\n      canvasCtx.strokeStyle = \"rgb(0 0 0)\";\r\n      canvasCtx.beginPath();\r\n      let x = 0;\r\n      let time = audioNode.history[0][0] - bufferTimeLength;\r\n      for (let i = 0; i < audioNode.history.length; i++) {\r\n        const data = audioNode.history[i][1];\r\n\r\n        for (let j = 0; j < data.length; j++) {\r\n          const v = data[j] / 128.0;\r\n          const y = v * (canvas.height / 2);\r\n\r\n          if (i === 0 && j == 0) {\r\n            canvasCtx.moveTo(canvas.width * x, y);\r\n          } else {\r\n            canvasCtx.lineTo(canvas.width * x, y);\r\n          }\r\n\r\n          x += sampleTick / windowSize;\r\n          time += sampleTick;\r\n          if (time > audioNode.history?.[i + 1]?.[0] - bufferTimeLength) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      canvasCtx.stroke();\r\n    }\r\n  }\r\n\r\n  requestAnimationFrame(draw);\r\n}\r\n\r\nfunction nodeCreated(id) {\r\n  const node = editor.getNodeFromId(id);\r\n\r\n  switch (node.class) {\r\n    case \"o\":\r\n      audioNodes[id] = audioContext.createOscillator();\r\n      audioNodes[id].start();\r\n      break;\r\n    case \"s\":\r\n      audioNodes[id] = audioContext;\r\n      break;\r\n    case \"g\":\r\n      audioNodes[id] = audioContext.createGain();\r\n      break;\r\n    case \"e\":\r\n      audioNodes[id] = new Envelope();\r\n      break;\r\n    case \"f\":\r\n      audioNodes[id] = audioContext.createBiquadFilter();\r\n      break;\r\n    case \"n\":\r\n      audioNodes[id] = new NoiseNode();\r\n      break;\r\n    default:\r\n      break;\r\n  }\r\n\r\n  switch (node.class) {\r\n    case \"o\":\r\n    case \"g\":\r\n    case \"e\":\r\n    case \"f\":\r\n    case \"n\":\r\n      const htmlBody = document\r\n        .getElementById(`node-${id}`)\r\n        .getElementsByClassName(\"drawflow_content_node\")[0].children[0];\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = 180;\r\n      canvas.height = 180;\r\n      htmlBody.appendChild(canvas);\r\n      const analyser = audioContext.createAnalyser();\r\n      analyser.fftSize = 2048;\r\n      const bufferLength = analyser.frequencyBinCount;\r\n      const dataArray = new Uint8Array(bufferLength);\r\n      analyser.getByteTimeDomainData(dataArray);\r\n\r\n      audioNodes[id].connect(analyser);\r\n\r\n      audioNodes[id].canvas = canvas;\r\n      audioNodes[id].analyser = analyser;\r\n      audioNodes[id].history = [];\r\n    default:\r\n      break;\r\n  }\r\n}\r\n\r\neditor.on(\"nodeCreated\", () => {\r\n  saveData();\r\n});\r\n\r\neditor.on(\"nodeRemoved\", function (id) {\r\n  saveData();\r\n  // remove connections\r\n});\r\n\r\neditor.on(\"nodeSelected\", function (id) {});\r\n\r\neditor.on(\"moduleCreated\", function (name) {});\r\n\r\neditor.on(\"moduleChanged\", function (name) {});\r\n\r\nclass NoiseNode extends AudioBufferSourceNode {\r\n  constructor() {\r\n    super(audioContext);\r\n    const bufferSize = 2 * audioContext.sampleRate;\r\n    const noiseBuffer = audioContext.createBuffer(\r\n      1,\r\n      bufferSize,\r\n      audioContext.sampleRate\r\n    );\r\n\r\n    this.type = \"white\";\r\n    this.buffer = noiseBuffer;\r\n    this.loop = true;\r\n\r\n    this.regenerateBuffer();\r\n    this.start(0);\r\n  }\r\n\r\n  regenerateBuffer() {\r\n    // https://noisehack.com/generate-noise-web-audio-api/\r\n    const output = this.buffer.getChannelData(0);\r\n    const bufferSize = 2 * audioContext.sampleRate;\r\n    switch (this.type) {\r\n      case \"pink\":\r\n        var b0, b1, b2, b3, b4, b5, b6;\r\n        b0 = b1 = b2 = b3 = b4 = b5 = b6 = 0.0;\r\n        for (var i = 0; i < bufferSize; i++) {\r\n          const white = Math.random() * 2 - 1;\r\n          b0 = 0.99886 * b0 + white * 0.0555179;\r\n          b1 = 0.99332 * b1 + white * 0.0750759;\r\n          b2 = 0.969 * b2 + white * 0.153852;\r\n          b3 = 0.8665 * b3 + white * 0.3104856;\r\n          b4 = 0.55 * b4 + white * 0.5329522;\r\n          b5 = -0.7616 * b5 - white * 0.016898;\r\n          output[i] = b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362;\r\n          output[i] *= 0.11; // (roughly) compensate for gain\r\n          b6 = white * 0.115926;\r\n        }\r\n        break;\r\n      case \"brown\":\r\n        var lastOut = 0;\r\n        for (var i = 0; i < bufferSize; i++) {\r\n          var white = Math.random() * 2 - 1;\r\n          output[i] = (lastOut + 0.02 * white) / 1.02;\r\n          lastOut = output[i];\r\n          output[i] *= 3.5; // (roughly) compensate for gain\r\n        }\r\n        break;\r\n      case \"white\":\r\n      default:\r\n        for (var i = 0; i < bufferSize; i++) {\r\n          output[i] = Math.random() * 2 - 1;\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  getInput(key) {\r\n    return this;\r\n  }\r\n\r\n  updateData(data) {\r\n    if (this.type != data.type) {\r\n      this.type = data.type;\r\n      this.regenerateBuffer();\r\n    }\r\n  }\r\n}\r\n\r\nclass Envelope extends GainNode {\r\n  constructor() {\r\n    super(audioContext);\r\n    this.constantNode = audioContext.createConstantSource();\r\n    this.constantNode.connect(this);\r\n    this.constantNode.start();\r\n    this.data = {\r\n      ramptype: \"exp\",\r\n      peak: 1,\r\n      attack: 1,\r\n      decay: 1,\r\n    };\r\n  }\r\n\r\n  applyEnvelope() {\r\n    var setValue;\r\n    var currentTime = audioContext.currentTime;\r\n\r\n    this.gain.cancelScheduledValues(currentTime);\r\n    switch (this.data.ramptype) {\r\n      case \"linear\":\r\n        setValue = (val, t) => this.gain.linearRampToValueAtTime(val, t);\r\n        break;\r\n      case \"instant\":\r\n        setValue = (val, t) => this.gain.setValueAtTime(val, t);\r\n        break;\r\n      default:\r\n      case \"exp\":\r\n        setValue = (val, t) => this.gain.exponentialRampToValueAtTime(val, t);\r\n        break;\r\n    }\r\n    const addStep = (val, deltaTime) => {\r\n      if (deltaTime > 0) {\r\n        currentTime += deltaTime;\r\n        setValue(val, currentTime);\r\n      }\r\n    };\r\n    if (this.data.attack > 0) {\r\n      this.gain.setValueAtTime(0.001, currentTime);\r\n    }\r\n\r\n    addStep(this.data.peak, this.data.attack);\r\n    addStep(0.001, this.data.decay);\r\n  }\r\n\r\n  getInput(key) {\r\n    return this;\r\n  }\r\n\r\n  updateData(data) {\r\n    this.data.ramptype = data.ramptype;\r\n    this.data.peak = Number(data.peak);\r\n    this.data.attack = Number(data.attack);\r\n    this.data.decay = Number(data.decay);\r\n    this.applyEnvelope();\r\n  }\r\n}\r\n\r\nBiquadFilterNode.prototype.getInput = function (key) {\r\n  switch (key) {\r\n    case \"input_1\":\r\n      return this;\r\n    case \"input_2\":\r\n    default:\r\n      return this.frequency;\r\n  }\r\n};\r\n\r\nAudioContext.prototype.getInput = function (key) {\r\n  switch (key) {\r\n    default:\r\n      return this.destination;\r\n  }\r\n};\r\n\r\nGainNode.prototype.getInput = function (key) {\r\n  switch (key) {\r\n    case \"input_1\":\r\n      return this;\r\n    case \"input_2\":\r\n    default:\r\n      return this.gain;\r\n  }\r\n};\r\n\r\nOscillatorNode.prototype.getInput = function (key) {\r\n  switch (key) {\r\n    default:\r\n      return this.frequency;\r\n  }\r\n};\r\n\r\nAudioContext.prototype.updateData = () => {};\r\nOscillatorNode.prototype.updateData = function (data) {\r\n  this.type = data.type;\r\n  this.frequency.value = Number(data.frequency);\r\n};\r\nGainNode.prototype.updateData = function (data) {\r\n  this.gain.value = Number(data.gain);\r\n};\r\nBiquadFilterNode.prototype.updateData = function (data) {\r\n  this.type = data.type;\r\n  this.frequency.value = Number(data.frequency);\r\n};\r\n\r\neditor.on(\"connectionCreated\", function (connection) {\r\n  const sendingNode = audioNodes[connection.output_id];\r\n  const recievingNode = audioNodes[connection.input_id];\r\n  if (sendingNode && recievingNode) {\r\n    sendingNode.connect(recievingNode.getInput(connection.input_class));\r\n  }\r\n  saveData();\r\n});\r\n\r\neditor.on(\"connectionRemoved\", function (connection) {\r\n  audioNodes[connection.output_id]?.disconnect(\r\n    audioNodes[connection.input_id].getInput(connection.input_class)\r\n  );\r\n  saveData();\r\n});\r\n\r\neditor.on(\"mouseMove\", function (position) {\r\n  //\r\n});\r\n\r\neditor.on(\"nodeDataChanged\", function (id) {\r\n  const { data } = editor.getNodeFromId(id);\r\n\r\n  audioNodes[id].updateData(data);\r\n  saveData();\r\n});\r\n\r\neditor.on(\"nodeMoved\", function (id) {});\r\n\r\neditor.on(\"zoom\", function (zoom) {});\r\n\r\neditor.on(\"translate\", function (position) {\r\n  //\r\n});\r\n\r\neditor.on(\"addReroute\", function (id) {});\r\n\r\neditor.on(\"removeReroute\", function (id) {});\r\n\r\n/* DRAG EVENT */\r\n\r\n/* Mouse and Touch Actions */\r\n\r\nvar elements = document.getElementsByClassName(\"drag-drawflow\");\r\nfor (var i = 0; i < elements.length; i++) {\r\n  elements[i].addEventListener(\"touchend\", drop, false);\r\n  elements[i].addEventListener(\"touchmove\", positionMobile, false);\r\n  elements[i].addEventListener(\"touchstart\", drag, false);\r\n}\r\n\r\nvar mobile_item_selec = \"\";\r\nvar mobile_last_move = null;\r\nfunction positionMobile(ev) {\r\n  mobile_last_move = ev;\r\n}\r\n\r\nfunction allowDrop(ev) {\r\n  ev.preventDefault();\r\n}\r\n\r\nfunction drag(ev) {\r\n  if (ev.type === \"touchstart\") {\r\n    mobile_item_selec = ev.target\r\n      .closest(\".drag-drawflow\")\r\n      .getAttribute(\"data-node\");\r\n  } else {\r\n    ev.dataTransfer.setData(\"node\", ev.target.getAttribute(\"data-node\"));\r\n  }\r\n}\r\n\r\nfunction drop(ev) {\r\n  if (ev.type === \"touchend\") {\r\n    var parentdrawflow = document\r\n      .elementFromPoint(\r\n        mobile_last_move.touches[0].clientX,\r\n        mobile_last_move.touches[0].clientY\r\n      )\r\n      .closest(\"#drawflow\");\r\n    if (parentdrawflow != null) {\r\n      addNodeToDrawFlow(\r\n        mobile_item_selec,\r\n        mobile_last_move.touches[0].clientX,\r\n        mobile_last_move.touches[0].clientY\r\n      );\r\n    }\r\n    mobile_item_selec = \"\";\r\n  } else {\r\n    ev.preventDefault();\r\n    var data = ev.dataTransfer.getData(\"node\");\r\n    addNodeToDrawFlow(data, ev.clientX, ev.clientY);\r\n  }\r\n}\r\n\r\nfunction addNodeToDrawFlow(name, pos_x, pos_y, data = null) {\r\n  if (editor.editor_mode === \"fixed\") {\r\n    return null;\r\n  }\r\n  pos_x =\r\n    pos_x *\r\n      (editor.precanvas.clientWidth /\r\n        (editor.precanvas.clientWidth * editor.zoom)) -\r\n    editor.precanvas.getBoundingClientRect().x *\r\n      (editor.precanvas.clientWidth /\r\n        (editor.precanvas.clientWidth * editor.zoom));\r\n  pos_y =\r\n    pos_y *\r\n      (editor.precanvas.clientHeight /\r\n        (editor.precanvas.clientHeight * editor.zoom)) -\r\n    editor.precanvas.getBoundingClientRect().y *\r\n      (editor.precanvas.clientHeight /\r\n        (editor.precanvas.clientHeight * editor.zoom));\r\n  var nodeId = null;\r\n  switch (name) {\r\n    case \"s\":\r\n      var output = `\r\n      <div>\r\n        <div class=\"title-box\"><i class=\"fas fa-at\"></i> Audio Out </div>\r\n      </div>\r\n      `;\r\n      nodeId = editor.addNode(\"s\", 1, 0, pos_x, pos_y, \"s\", data ?? {}, output);\r\n      break;\r\n    case \"g\":\r\n      var gain = `\r\n        <div>\r\n          <div class=\"title-box\"><i class=\"fas fa-at\"></i> Gain</div>\r\n      <div class=\"box\">\r\n        <p>Gain</p>\r\n        <input type=\"number\" df-gain>\r\n      </div>\r\n        </div>\r\n        `;\r\n      nodeId = editor.addNode(\r\n        \"g\",\r\n        2,\r\n        1,\r\n        pos_x,\r\n        pos_y,\r\n        \"g\",\r\n        data ?? { gain: 1 },\r\n        gain\r\n      );\r\n      break;\r\n\r\n    case \"e\":\r\n      var env = `\r\n      <div>\r\n        <div class=\"title-box\"><i class=\"fab fa-telegram-plane\"></i> Envelope</div>\r\n        <div class=\"box\">\r\n          <p>Select type</p>\r\n          <select df-ramptype>\r\n            <option value=\"exp\">Exponential</option>\r\n            <option value=\"linear\">Linear</option>\r\n            <option value=\"instant\">Instant</option>\r\n          </select>\r\n        </div>\r\n        <div class=\"box\">\r\n          <p>Attack</p>\r\n          <input type=\"number\" df-attack>\r\n        </div>\r\n        <div class=\"box\">\r\n          <p>Decay</p>\r\n          <input type=\"number\" df-decay>\r\n        </div>\r\n        <div class=\"box\">\r\n          <p>Peak</p>\r\n          <input type=\"number\" df-peak>\r\n        </div>\r\n      </div>\r\n      `;\r\n      nodeId = editor.addNode(\r\n        \"e\",\r\n        0,\r\n        1,\r\n        pos_x,\r\n        pos_y,\r\n        \"e\",\r\n        data ?? { ramptype: \"exp\", attack: 1, peak: 1, decay: 1 },\r\n        env\r\n      );\r\n      break;\r\n\r\n    case \"n\":\r\n      var noise = `\r\n        <div>\r\n          <div class=\"title-box\"><i class=\"fab fa-telegram-plane\"></i> Noise</div>\r\n          <div class=\"box\">\r\n            <p>Select type</p>\r\n            <select df-type>\r\n              <option value=\"white\">White</option>\r\n              <option value=\"pink\">Pink</option>\r\n              <option value=\"brown\">Brown</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n        `;\r\n      nodeId = editor.addNode(\r\n        \"n\",\r\n        0,\r\n        1,\r\n        pos_x,\r\n        pos_y,\r\n        \"n\",\r\n        data ?? { type: \"white\" },\r\n        noise\r\n      );\r\n      break;\r\n\r\n    case \"f\":\r\n      var filter = `\r\n      <div>\r\n        <div class=\"title-box\"><i class=\"fab fa-telegram-plane\"></i> Filter</div>\r\n        <div class=\"box\">\r\n          <p>Select type</p>\r\n          <select df-type>\r\n            <option value=\"lowpass\">Low Pass</option>\r\n            <option value=\"highpass\">High Pass</option>\r\n            <option value=\"bandpass\">Band Pass</option>\r\n            <option value=\"lowshelf\">Low Shelf</option>\r\n            <option value=\"peaking\">Peaking</option>\r\n            <option value=\"notch\">Notch</option>\r\n            <option value=\"allpass\">All Pass</option>\r\n          </select>\r\n        </div>\r\n        <div class=\"box\">\r\n          <p>Frequency</p>\r\n          <input type=\"number\" df-frequency>\r\n        </div>\r\n      </div>\r\n      `;\r\n      nodeId = editor.addNode(\r\n        \"f\",\r\n        2,\r\n        1,\r\n        pos_x,\r\n        pos_y,\r\n        \"f\",\r\n        data ?? { type: \"lowpass\", frequency: 200 },\r\n        filter\r\n      );\r\n      break;\r\n\r\n    case \"o\":\r\n      var osc = `\r\n    <div>\r\n      <div class=\"title-box\"><i class=\"fab fa-telegram-plane\"></i> Oscillator</div>\r\n      <div class=\"box\">\r\n        <p>Select type</p>\r\n        <select df-type>\r\n          <option value=\"sine\">Sine</option>\r\n          <option value=\"square\">Square</option>\r\n          <option value=\"sawtooth\">Sawtooth</option>\r\n          <option value=\"triangle\">Triangle</option>\r\n        </select>\r\n      </div>\r\n      <div class=\"box\">\r\n        <p>Frequency</p>\r\n        <input type=\"number\" df-frequency>\r\n      </div>\r\n    </div>\r\n    `;\r\n      nodeId = editor.addNode(\r\n        \"o\",\r\n        1,\r\n        1,\r\n        pos_x,\r\n        pos_y,\r\n        \"o\",\r\n        data ?? { type: \"sine\", frequency: 260 },\r\n        osc\r\n      );\r\n      break;\r\n\r\n    default:\r\n      return null;\r\n  }\r\n  nodeCreated(nodeId);\r\n  return nodeId;\r\n}\r\n\r\nvar transform = \"\";\r\nfunction showpopup(e) {\r\n  e.target.closest(\".drawflow-node\").style.zIndex = \"9999\";\r\n  e.target.children[0].style.display = \"block\";\r\n  //document.getElementById(\"modalfix\").style.display = \"block\";\r\n\r\n  //e.target.children[0].style.transform = 'translate('+translate.x+'px, '+translate.y+'px)';\r\n  transform = editor.precanvas.style.transform;\r\n  editor.precanvas.style.transform = \"\";\r\n  editor.precanvas.style.left = editor.canvas_x + \"px\";\r\n  editor.precanvas.style.top = editor.canvas_y + \"px\";\r\n\r\n  //e.target.children[0].style.top  =  -editor.canvas_y - editor.container.offsetTop +'px';\r\n  //e.target.children[0].style.left  =  -editor.canvas_x  - editor.container.offsetLeft +'px';\r\n  editor.editor_mode = \"fixed\";\r\n}\r\n\r\nfunction closemodal(e) {\r\n  e.target.closest(\".drawflow-node\").style.zIndex = \"2\";\r\n  e.target.parentElement.parentElement.style.display = \"none\";\r\n  //document.getElementById(\"modalfix\").style.display = \"none\";\r\n  editor.precanvas.style.transform = transform;\r\n  editor.precanvas.style.left = \"0px\";\r\n  editor.precanvas.style.top = \"0px\";\r\n  editor.editor_mode = \"edit\";\r\n}\r\n\r\nfunction changeModule(event) {\r\n  var all = document.querySelectorAll(\".menu ul li\");\r\n  for (var i = 0; i < all.length; i++) {\r\n    all[i].classList.remove(\"selected\");\r\n  }\r\n  event.target.classList.add(\"selected\");\r\n}\r\n\r\nfunction changeMode(option) {\r\n  //\r\n  if (option == \"lock\") {\r\n    lock.style.display = \"none\";\r\n    unlock.style.display = \"block\";\r\n  } else {\r\n    lock.style.display = \"block\";\r\n    unlock.style.display = \"none\";\r\n  }\r\n}\r\n\r\nfunction trigger() {\r\n  for (const [_, audioNode] of Object.entries(audioNodes)) {\r\n    if (audioNode.applyEnvelope) {\r\n      audioNode.applyEnvelope();\r\n    }\r\n  }\r\n}\r\n\r\nwindow.drop = drop;\r\nwindow.drag = drag;\r\nwindow.allowDrop = allowDrop;\r\nwindow.trigger = trigger;\r\nwindow.editor = editor;\r\n\r\nreadData();\r\nrequestAnimationFrame(draw);\r\n"],"names":["id","editor","audioContext","audioNodes","stateString","compress","str","compressedStream","chunks","chunk","concatUint8Arrays","decompress","compressedBytes","decompressedStream","stringBytes","uint8arrays","buffer","toString","data","encodeToUrl","dataString","uint8Array","base64UrlSafe","url","decodeFromUrl","base64","char","readData","state","connectionsMap","idMap","_","value","outputs","outputName","i","node","output","distanceToSink","connections","newDist","connections2","connection","d","countOfDist","position","dist","count","name","newId","addNodeToDrawFlow","connectionList","inputId","inputName","saveData","draw","timestamp","audioNode","canvas","analyser","canvasCtx","bufferLength","dataArray","windowSize","time","bufferTimeLength","sampleTick","x","j","y","_b","_a","nodeCreated","Envelope","NoiseNode","htmlBody","bufferSize","noiseBuffer","b0","b1","b2","b3","b4","b5","b6","white","lastOut","key","setValue","currentTime","val","t","addStep","deltaTime","sendingNode","recievingNode","zoom","elements","drop","positionMobile","drag","mobile_item_selec","mobile_last_move","ev","allowDrop","parentdrawflow","pos_x","pos_y","nodeId","gain","env","noise","filter","osc","trigger"],"mappings":"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"}