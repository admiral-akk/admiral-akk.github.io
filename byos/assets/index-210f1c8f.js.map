{"version":3,"file":"index-210f1c8f.js","sources":["../../raw_code/byos/src/util/compression.js","../../raw_code/byos/src/nodes/envelopeNode.js","../../raw_code/byos/src/nodes/noiseNode.js","../../raw_code/byos/src/nodes/clockNode.js","../../raw_code/byos/src/nodes/biquadFilter.js","../../raw_code/byos/src/nodes/oscillator.js","../../raw_code/byos/src/nodes/gain.js","../../raw_code/byos/src/nodes/output.js","../../raw_code/byos/src/nodes/delay.js","../../raw_code/byos/src/script.js"],"sourcesContent":["// https://evanhahn.com/javascript-compression-streams-api-with-strings/\r\nasync function concatUint8Arrays(uint8arrays) {\r\n  const blob = new Blob(uint8arrays);\r\n  const buffer = await blob.arrayBuffer();\r\n  return new Uint8Array(buffer);\r\n}\r\n\r\nclass ApiCompressor {\r\n  constructor(compressionType = \"gzip\") {\r\n    this.compressionType = compressionType;\r\n  }\r\n\r\n  // https://evanhahn.com/javascript-compression-streams-api-with-strings/\r\n  async compressStrToBase64(str) {\r\n    // Convert the string to a byte stream.\r\n    const stream = new Blob([str]).stream();\r\n\r\n    // Create a compressed stream.\r\n    const compressedStream = stream.pipeThrough(\r\n      new CompressionStream(this.compressionType)\r\n    );\r\n\r\n    // Read all the bytes from this stream.\r\n    const chunks = [];\r\n    for await (const chunk of compressedStream) {\r\n      chunks.push(chunk);\r\n    }\r\n    const uint8Array = await concatUint8Arrays(chunks);\r\n    return btoa(String.fromCharCode.apply(null, uint8Array));\r\n  }\r\n\r\n  // https://evanhahn.com/javascript-compression-streams-api-with-strings/\r\n  async decompressBase64ToStr(base64) {\r\n    const uint8Array = new Uint8Array(\r\n      atob(base64)\r\n        .split(\"\")\r\n        .map((char) => char.charCodeAt(0))\r\n    );\r\n    // Convert the bytes to a stream.\r\n    const stream = new Blob([uint8Array]).stream();\r\n\r\n    // Create a decompressed stream.\r\n    const decompressedStream = stream.pipeThrough(\r\n      new DecompressionStream(this.compressionType)\r\n    );\r\n\r\n    // Read all the bytes from this stream.\r\n    const chunks = [];\r\n    for await (const chunk of decompressedStream) {\r\n      chunks.push(chunk);\r\n    }\r\n    const stringBytes = await concatUint8Arrays(chunks);\r\n    return new TextDecoder().decode(stringBytes);\r\n  }\r\n}\r\n\r\nclass DefaultCompressor {\r\n  async compressStrToBase64(str) {\r\n    return btoa(str);\r\n  }\r\n  async decompressBase64ToStr(base64) {\r\n    return atob(base64);\r\n  }\r\n}\r\n\r\nclass DefaultPreprocessor {\r\n  async jsonToString(jsonData) {\r\n    return JSON.stringify(jsonData);\r\n  }\r\n\r\n  async jsonFromString(jsonData) {\r\n    return JSON.parse(jsonData);\r\n  }\r\n}\r\n\r\nclass DataManager {\r\n  constructor(\r\n    compressor = new DefaultCompressor(),\r\n    preprocessor = new DefaultPreprocessor()\r\n  ) {\r\n    this.compressor = compressor;\r\n    this.preprocessor = preprocessor;\r\n  }\r\n\r\n  async saveData(jsonData) {\r\n    const str = await this.preprocessor.jsonToString(jsonData);\r\n    console.log(\"URL param processed\", str);\r\n    const base64 = await this.compressor.compressStrToBase64(str);\r\n    console.log(\"URL param length\", base64.length);\r\n    const base64UrlStr = base64\r\n      .replace(/\\+/g, \"-\")\r\n      .replace(/\\//g, \"_\")\r\n      .replace(/=/g, \".\");\r\n    const url = new URL(window.location.href);\r\n    url.searchParams.set(\"d\", base64UrlStr);\r\n    window.history.pushState(null, \"\", url.toString());\r\n  }\r\n\r\n  async fetchData() {\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const base64UrlStr = urlParams.get(\"d\");\r\n    if (!base64UrlStr) {\r\n      return null;\r\n    }\r\n    const base64 = base64UrlStr\r\n      .replace(/-/g, \"+\")\r\n      .replace(/_/g, \"/\")\r\n      .replace(/\\./g, \"=\");\r\n    const str = await this.compressor.decompressBase64ToStr(base64);\r\n    return await this.preprocessor.jsonFromString(str);\r\n  }\r\n}\r\n\r\nexport { DataManager, DefaultCompressor, ApiCompressor, DefaultPreprocessor };\r\n","class EnvelopeNode extends GainNode {\r\n  static types = [\"linear\", \"instant\", \"exp\"];\r\n  constructor(audioContext) {\r\n    super(audioContext);\r\n    this.constantNode = audioContext.createConstantSource();\r\n    this.constantNode.connect(this);\r\n    this.constantNode.start();\r\n    this.gain.value = 0;\r\n    this.data = {\r\n      ramptype: \"exp\",\r\n      peak: 1,\r\n      attack: 1,\r\n      decay: 1,\r\n    };\r\n  }\r\n\r\n  static shortName = \"e\";\r\n\r\n  static dataToString(data) {\r\n    const { ramptype, peak, attack, decay } = data;\r\n    const typeIndex = EnvelopeNode.types.indexOf(ramptype);\r\n    const dataStr = `${typeIndex}${peak},${attack},${decay}`;\r\n\r\n    return dataStr;\r\n  }\r\n\r\n  static dataFromString(str) {\r\n    const ramptype = EnvelopeNode.types[Number(str[0])];\r\n    const [peak, attack, decay] = str.substring(1).split(\",\");\r\n    return {\r\n      ramptype,\r\n      attack: Number(attack),\r\n      decay: Number(decay),\r\n      peak: Number(peak),\r\n    };\r\n  }\r\n\r\n  getInput(key) {\r\n    return this;\r\n  }\r\n\r\n  updateData(data) {\r\n    this.data.ramptype = data.ramptype;\r\n    this.data.peak = Number(data.peak);\r\n    this.data.attack = Number(data.attack);\r\n    this.data.decay = Number(data.decay);\r\n  }\r\n\r\n  applyEnvelope(time) {\r\n    var setValue;\r\n    var currentTime = time;\r\n\r\n    this.gain.cancelAndHoldAtTime(currentTime);\r\n    switch (this.data.ramptype) {\r\n      case \"linear\":\r\n        setValue = (val, t) => this.gain.linearRampToValueAtTime(val, t);\r\n        break;\r\n      case \"instant\":\r\n        setValue = (val, t) => this.gain.setValueAtTime(val, t);\r\n        break;\r\n      default:\r\n      case \"exp\":\r\n        setValue = (val, t) => this.gain.exponentialRampToValueAtTime(val, t);\r\n        break;\r\n    }\r\n    const addStep = (val, deltaTime) => {\r\n      if (deltaTime > 0) {\r\n        currentTime += deltaTime;\r\n        setValue(val, currentTime);\r\n      }\r\n    };\r\n    if (this.data.attack > 0) {\r\n      this.gain.setValueAtTime(0.001, currentTime);\r\n    }\r\n\r\n    addStep(this.data.peak, this.data.attack);\r\n    addStep(0.001, this.data.decay);\r\n    this.gain.setTargetAtTime(0, currentTime, 0.013);\r\n  }\r\n}\r\n\r\nexport { EnvelopeNode };\r\n","class NoiseNode extends AudioBufferSourceNode {\r\n  constructor(audioContext) {\r\n    super(audioContext);\r\n    const bufferSize = 2 * audioContext.sampleRate;\r\n    const noiseBuffer = audioContext.createBuffer(\r\n      1,\r\n      bufferSize,\r\n      audioContext.sampleRate\r\n    );\r\n\r\n    this.type = \"white\";\r\n    this.buffer = noiseBuffer;\r\n    this.loop = true;\r\n\r\n    this.regenerateBuffer();\r\n    this.start(0);\r\n  }\r\n\r\n  static shortName = \"n\";\r\n\r\n  static dataToString(data) {\r\n    switch (data.type) {\r\n      default:\r\n      case \"white\":\r\n        return \"0\";\r\n      case \"pink\":\r\n        return \"1\";\r\n      case \"brown\":\r\n        return \"2\";\r\n    }\r\n  }\r\n\r\n  static dataFromString(str) {\r\n    const num = Number(str);\r\n    switch (num) {\r\n      default:\r\n      case \"0\":\r\n        return \"white\";\r\n      case \"1\":\r\n        return \"pink\";\r\n      case \"2\":\r\n        return \"brown\";\r\n    }\r\n  }\r\n\r\n  regenerateBuffer() {\r\n    // https://noisehack.com/generate-noise-web-audio-api/\r\n    const output = this.buffer.getChannelData(0);\r\n    const bufferSize = 2 * this.context.sampleRate;\r\n    switch (this.type) {\r\n      case \"pink\":\r\n        var b0, b1, b2, b3, b4, b5, b6;\r\n        b0 = b1 = b2 = b3 = b4 = b5 = b6 = 0.0;\r\n        for (var i = 0; i < bufferSize; i++) {\r\n          const white = Math.random() * 2 - 1;\r\n          b0 = 0.99886 * b0 + white * 0.0555179;\r\n          b1 = 0.99332 * b1 + white * 0.0750759;\r\n          b2 = 0.969 * b2 + white * 0.153852;\r\n          b3 = 0.8665 * b3 + white * 0.3104856;\r\n          b4 = 0.55 * b4 + white * 0.5329522;\r\n          b5 = -0.7616 * b5 - white * 0.016898;\r\n          output[i] = b0 + b1 + b2 + b3 + b4 + b5 + b6 + white * 0.5362;\r\n          output[i] *= 0.11; // (roughly) compensate for gain\r\n          b6 = white * 0.115926;\r\n        }\r\n        break;\r\n      case \"brown\":\r\n        var lastOut = 0;\r\n        for (var i = 0; i < bufferSize; i++) {\r\n          var white = Math.random() * 2 - 1;\r\n          output[i] = (lastOut + 0.02 * white) / 1.02;\r\n          lastOut = output[i];\r\n          output[i] *= 3.5; // (roughly) compensate for gain\r\n        }\r\n        break;\r\n      case \"white\":\r\n      default:\r\n        for (var i = 0; i < bufferSize; i++) {\r\n          output[i] = Math.random() * 2 - 1;\r\n        }\r\n        break;\r\n    }\r\n  }\r\n\r\n  getInput(key) {\r\n    return this;\r\n  }\r\n\r\n  updateData(data) {\r\n    if (this.type != data.type) {\r\n      this.type = data.type;\r\n      this.regenerateBuffer();\r\n    }\r\n  }\r\n}\r\n\r\nexport { NoiseNode };\r\n","class ClockNode {\r\n  constructor(context) {\r\n    this.context = context;\r\n    this.bpm = 60;\r\n    this.connections = [];\r\n    this.schedule();\r\n  }\r\n\r\n  static shortName = \"c\";\r\n\r\n  static dataToString(data) {\r\n    return `${data.bpm}`;\r\n  }\r\n\r\n  schedule() {\r\n    const currentTime = this.context.currentTime;\r\n    const minBPM = Math.max(1, this.bpm);\r\n    const nextNoteTime =\r\n      currentTime + 60 / minBPM - (currentTime % (60 / minBPM));\r\n    const nextNextNoteTime = nextNoteTime + 60 / minBPM;\r\n    for (let i = 0; i < this.connections.length; i++) {\r\n      const connection = this.connections[i];\r\n      connection.applyEnvelope(nextNoteTime);\r\n      connection.applyEnvelope(nextNextNoteTime);\r\n    }\r\n    setTimeout(() => {\r\n      this.schedule();\r\n    }, 30 / Math.max(60, minBPM));\r\n  }\r\n\r\n  static dataFromString(str) {\r\n    return { bpm: Number(str) };\r\n  }\r\n\r\n  getInput(key) {\r\n    return this;\r\n  }\r\n\r\n  updateData(data) {\r\n    this.bpm = Number(data.bpm);\r\n  }\r\n\r\n  connect(recievingInput) {\r\n    console.log(\"current\", this.context.currentTime);\r\n    this.connections.push(recievingInput);\r\n  }\r\n\r\n  disconnect(targetInput) {\r\n    const index = this.connections.indexOf(targetInput);\r\n    if (index > -1) {\r\n      this.connections = this.connections.splice(index, 1);\r\n    }\r\n  }\r\n}\r\n\r\nexport { ClockNode };\r\n","class BiquadFilter extends BiquadFilterNode {\r\n  constructor(context) {\r\n    super(context);\r\n  }\r\n  static shortName = \"f\";\r\n  updateData(data) {\r\n    this.type = data.type;\r\n    this.frequency.value = Number(data.frequency);\r\n  }\r\n\r\n  getInput(key) {\r\n    switch (key) {\r\n      case \"input_1\":\r\n        return this;\r\n      case \"input_2\":\r\n      default:\r\n        return this.frequency;\r\n    }\r\n  }\r\n\r\n  static types = [\r\n    \"lowpass\",\r\n    \"highpass\",\r\n    \"bandpass\",\r\n    \"lowshelf\",\r\n    \"peaking\",\r\n    \"notch\",\r\n    \"allpass\",\r\n  ];\r\n\r\n  static dataToString(data) {\r\n    const { type, frequency } = data;\r\n    const typeIndex = BiquadFilter.types.indexOf(type);\r\n    return `${typeIndex}${frequency}`;\r\n  }\r\n\r\n  static dataFromString(str) {\r\n    return {\r\n      type: BiquadFilter.types[Number(str[0])],\r\n      frequency: Number(str.substring(1)),\r\n    };\r\n  }\r\n}\r\n\r\nexport { BiquadFilter };\r\n","class Oscillator extends OscillatorNode {\r\n  constructor(context) {\r\n    super(context);\r\n    this.start();\r\n  }\r\n  static shortName = \"o\";\r\n  static types = [\"sine\", \"square\", \"sawtooth\", \"triangle\"];\r\n  getInput(key) {\r\n    switch (key) {\r\n      default:\r\n        return this.frequency;\r\n    }\r\n  }\r\n  static dataToString = function (data) {\r\n    const { type, frequency } = data;\r\n    const typeIndex = Oscillator.types.indexOf(type);\r\n    return `${typeIndex}${frequency}`;\r\n  };\r\n  static dataFromString = function (str) {\r\n    return {\r\n      type: Oscillator.types[Number(str[0])],\r\n      frequency: Number(str.substring(1)),\r\n    };\r\n  };\r\n  updateData(data) {\r\n    this.type = data.type;\r\n    this.frequency.value = Number(data.frequency);\r\n  }\r\n}\r\n\r\nexport { Oscillator };\r\n","class Gain extends GainNode {\r\n  constructor(context) {\r\n    super(context);\r\n  }\r\n  static shortName = \"g\";\r\n\r\n  getInput(key) {\r\n    switch (key) {\r\n      case \"input_1\":\r\n        return this;\r\n      case \"input_2\":\r\n      default:\r\n        return this.gain;\r\n    }\r\n  }\r\n  static dataToString(data) {\r\n    return `${data.gain}`;\r\n  }\r\n  static dataFromString(str) {\r\n    return {\r\n      gain: Number(str),\r\n    };\r\n  }\r\n  updateData(data) {\r\n    this.gain.value = Number(data.gain);\r\n  }\r\n}\r\n\r\nexport { Gain };\r\n","class Output {\r\n  constructor(context) {\r\n    this.context = context;\r\n  }\r\n\r\n  static shortName = \"s\";\r\n\r\n  getInput(key) {\r\n    switch (key) {\r\n      default:\r\n        return this.context.destination;\r\n    }\r\n  }\r\n  static dataToString = function (data) {\r\n    return ``;\r\n  };\r\n  static dataFromString = function (str) {\r\n    return {};\r\n  };\r\n\r\n  updateData() {}\r\n}\r\n\r\nexport { Output };\r\n","class Delay extends DelayNode {\r\n  constructor(context) {\r\n    super(context);\r\n  }\r\n  static shortName = \"d\";\r\n  getInput(key) {\r\n    switch (key) {\r\n      case \"input_1\":\r\n        return this;\r\n      case \"input_2\":\r\n      default:\r\n        return this.delayTime;\r\n    }\r\n  }\r\n  updateData(data) {\r\n    this.delayTime.value = Number(data.delay);\r\n  }\r\n\r\n  static dataFromString(str) {\r\n    const delay = Number(str);\r\n    return {\r\n      delay,\r\n    };\r\n  }\r\n  static dataToString(data) {\r\n    const { delay } = data;\r\n    const dataStr = `${delay}`;\r\n\r\n    return dataStr;\r\n  }\r\n}\r\n\r\nexport { Delay };\r\n","import { DataManager, DefaultCompressor } from \"./util/compression.js\";\r\nimport { EnvelopeNode } from \"./nodes/envelopeNode.js\";\r\nimport { NoiseNode } from \"./nodes/noiseNode.js\";\r\nimport { ClockNode } from \"./nodes/clockNode.js\";\r\nimport { BiquadFilter } from \"./nodes/biquadFilter.js\";\r\nimport { Oscillator } from \"./nodes/oscillator.js\";\r\nimport { Gain } from \"./nodes/gain.js\";\r\nimport { Output } from \"./nodes/output.js\";\r\nimport { Delay } from \"./nodes/delay.js\";\r\n\r\nvar id = document.getElementById(\"drawflow\");\r\nconst editor = new Drawflow(id);\r\nvar audioContext = new (window.AudioContext || window.webkitAudioContext)();\r\neditor.reroute = true;\r\neditor.start();\r\n\r\nvar toAudioNodeType = {};\r\nclass DrawflowPreprocessor {\r\n  minifyConnections(outputs) {\r\n    var str = \"\";\r\n    for (const [outputName, { connections }] of Object.entries(outputs)) {\r\n      const shortName = outputName.replace(\"output_\", \"\");\r\n      for (let i = 0; i < connections.length; i++) {\r\n        const { node, output } = connections[i];\r\n        const shortInputName = output.replace(\"input_\", \"\");\r\n        if (str !== \"\") {\r\n          str += \",\";\r\n        }\r\n        str += `${shortName},${node},${shortInputName}`;\r\n      }\r\n    }\r\n    return str;\r\n  }\r\n\r\n  unminifyConnections(outputStr) {\r\n    if (outputStr === \"\") {\r\n      return {};\r\n    }\r\n\r\n    const outputs = {};\r\n\r\n    const splitStr = outputStr.split(\",\");\r\n\r\n    for (let i = 0; i < splitStr.length / 3; i++) {\r\n      const outputName = `output_${splitStr[3 * i]}`;\r\n      const node = `${splitStr[3 * i + 1]}`;\r\n      const output = `input_${splitStr[3 * i + 2]}`;\r\n      if (!(outputName in outputs)) {\r\n        outputs[outputName] = { connections: [] };\r\n      }\r\n      outputs[outputName].connections.push({ node, output });\r\n    }\r\n\r\n    return outputs;\r\n  }\r\n\r\n  async jsonToString(jsonData) {\r\n    const arrayForm = [];\r\n    for (const [key, value] of Object.entries(jsonData)) {\r\n      const { data, id, name, outputs, pos_x, pos_y } = value;\r\n\r\n      const outputList = [];\r\n      for (const [outputName, c] of Object.entries(outputs)) {\r\n        const connections = c.connections;\r\n        if (connections.length > 0) {\r\n          outputList.push([outputName.replace(\"output_\", \"\"), connections]);\r\n        }\r\n      }\r\n      const x = Math.round(pos_x);\r\n      const y = Math.round(pos_y);\r\n      const compressedObj = {\r\n        id,\r\n        name,\r\n        x,\r\n        y,\r\n      };\r\n\r\n      const outputListNullable = this.minifyConnections(outputs);\r\n      console.log(name);\r\n      console.log(toAudioNodeType.get(name.toString()));\r\n      const dataNullable = toAudioNodeType\r\n        .get(name.toString())\r\n        .dataToString(data);\r\n\r\n      const compressedStr = `${id}|${name}|${x}|${y}|${outputListNullable}|${dataNullable}`;\r\n\r\n      if (outputList.length > 0) {\r\n        compressedObj.o = outputList;\r\n      }\r\n      if (Object.keys(data).length > 0) {\r\n        compressedObj.data = data;\r\n      }\r\n\r\n      arrayForm.push(compressedStr);\r\n    }\r\n\r\n    return JSON.stringify(arrayForm);\r\n  }\r\n  async jsonFromString(jsonStr) {\r\n    const arrayForm = JSON.parse(jsonStr);\r\n\r\n    const drawflowData = {};\r\n    for (let i = 0; i < arrayForm.length; i++) {\r\n      const compressedStr = arrayForm[i];\r\n\r\n      const [id, name, x, y, outputsNullable, dataNullable] =\r\n        compressedStr.split(\"|\");\r\n\r\n      const data = toAudioNodeType\r\n        .get(name.toString())\r\n        .dataFromString(dataNullable);\r\n      const outputs = this.unminifyConnections(outputsNullable);\r\n      console.log(outputs);\r\n      drawflowData[id] = {\r\n        data,\r\n        id: id,\r\n        name: name,\r\n        outputs,\r\n        pos_x: Number(x),\r\n        pos_y: Number(y),\r\n      };\r\n    }\r\n\r\n    return drawflowData;\r\n  }\r\n}\r\n\r\nconst dataManager = new DataManager(\r\n  new DefaultCompressor(),\r\n  new DrawflowPreprocessor()\r\n);\r\n\r\n// Events!\r\nconst audioNodes = new Map();\r\n\r\n// compression scheme:\r\n\r\nfunction minifyData(editorData) {\r\n  if (typeof editorData !== \"object\" || editorData === null) {\r\n    return null;\r\n  }\r\n  const newData = {};\r\n  for (const [key, value] of Object.entries(editorData.drawflow.Home.data)) {\r\n    const { data, id, name, outputs, pos_x, pos_y } = value;\r\n    newData[key] = {\r\n      data,\r\n      id,\r\n      name,\r\n      outputs,\r\n      pos_x,\r\n      pos_y,\r\n    };\r\n  }\r\n\r\n  return newData;\r\n}\r\n\r\nfunction unminifyData(urlData) {\r\n  if (typeof urlData !== \"object\" || urlData === null) {\r\n    return null;\r\n  }\r\n  const newData = { drawflow: { Home: { data: urlData } } };\r\n  return newData;\r\n}\r\n\r\nasync function saveTransformedData() {\r\n  return dataManager.saveData(minifyData(editor.export()));\r\n}\r\n\r\nasync function readData() {\r\n  const dataP = unminifyData(await dataManager.fetchData());\r\n  if (dataP && dataP != \"undefined\" && dataP !== null) {\r\n    const { data } = dataP.drawflow.Home;\r\n\r\n    const connectionsMap = {};\r\n    const idMap = {};\r\n    const newIdMap = {};\r\n\r\n    // first identify the network graph\r\n\r\n    for (const [_, value] of Object.entries(data)) {\r\n      const { id, outputs } = value;\r\n      connectionsMap[id] = {};\r\n      for (const [outputName, value] of Object.entries(outputs)) {\r\n        connectionsMap[id][outputName] = [];\r\n        for (let i = 0; i < value.connections.length; i++) {\r\n          const { node, output } = value.connections[i];\r\n          connectionsMap[id][outputName].push({ id: node, inputName: output });\r\n        }\r\n      }\r\n    }\r\n\r\n    // identify sink nodes, then measure distance to sink, and that's the x value\r\n    // then use different y per node\r\n\r\n    const sinkIds = [];\r\n    const distanceToSink = {};\r\n    // identify sink nodes\r\n    for (const [id, connections] of Object.entries(connectionsMap)) {\r\n      if (Object.keys(connections).length === 0) {\r\n        sinkIds.push(id);\r\n        distanceToSink[id] = 0;\r\n      }\r\n    }\r\n\r\n    // measure distance to sink\r\n    var newDist = {};\r\n    while (true) {\r\n      for (const [id, connections] of Object.entries(connectionsMap)) {\r\n        if (id.toString() in distanceToSink) {\r\n          continue;\r\n        }\r\n\r\n        for (const [outputName, connections2] of Object.entries(connections)) {\r\n          for (let i = 0; i < connections2.length; i++) {\r\n            const connection = connections2[i];\r\n            const d = distanceToSink[Number(connection.id)];\r\n            if (d !== undefined) {\r\n              if (newDist[id] !== undefined) {\r\n                newDist[id] = Math.min(newDist[id], d);\r\n              } else {\r\n                newDist[id] = d;\r\n              }\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (Object.keys(newDist).length === 0) {\r\n        break;\r\n      } else {\r\n        for (const [id, d] of Object.entries(newDist)) {\r\n          distanceToSink[id] = d + 1;\r\n        }\r\n        newDist = {};\r\n      }\r\n    }\r\n\r\n    for (const [id, value] of Object.entries(data)) {\r\n      if (distanceToSink[id] === undefined) {\r\n      }\r\n    }\r\n\r\n    // calculate positions of nodes\r\n\r\n    const countOfDist = {};\r\n    const position = {};\r\n    for (const [id, value] of Object.entries(data)) {\r\n      const dist = distanceToSink[id];\r\n      if (countOfDist[dist] === undefined) {\r\n        countOfDist[dist] = 1;\r\n      } else {\r\n        countOfDist[dist] = countOfDist[dist] + 1;\r\n      }\r\n      const count = countOfDist[dist];\r\n\r\n      position[id] = { posX: -dist * 300 + 800, posY: 500 * count };\r\n    }\r\n\r\n    // then figure out which positions to put nodes in and create the nodes\r\n\r\n    for (const [_, value] of Object.entries(data)) {\r\n      const { id, name, data, pos_x, pos_y } = value;\r\n\r\n      const newId = addNodeToDrawFlow(name, pos_x, pos_y, data);\r\n\r\n      audioNodes[newId].updateData(data);\r\n\r\n      idMap[id] = newId;\r\n      newIdMap[newId] = id;\r\n    }\r\n    // then connect the nodes\r\n    for (const [id, connections] of Object.entries(connectionsMap)) {\r\n      for (const [outputName, connectionList] of Object.entries(connections)) {\r\n        for (let i = 0; i < connectionList.length; i++) {\r\n          const inputId = connectionList[i].id;\r\n          const inputName = connectionList[i].inputName;\r\n          editor.addConnection(\r\n            idMap[id],\r\n            idMap[inputId],\r\n            outputName,\r\n            inputName\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n  await saveTransformedData();\r\n}\r\n\r\nfunction draw() {\r\n  audioContext.resume();\r\n  const timestamp = Date.now();\r\n  for (const [_, audioNode] of Object.entries(audioNodes)) {\r\n    const canvas = audioNode.canvas;\r\n    const analyser = audioNode.analyser;\r\n    if (canvas && analyser) {\r\n      const canvasCtx = canvas.getContext(\"2d\");\r\n      const bufferLength = analyser.frequencyBinCount;\r\n      const dataArray = new Uint8Array(bufferLength);\r\n      analyser.getByteTimeDomainData(dataArray);\r\n\r\n      audioNode.history.push([timestamp, dataArray]);\r\n\r\n      const windowSize = 500;\r\n\r\n      audioNode.history = audioNode.history.filter(\r\n        ([time, _]) => time > timestamp - windowSize\r\n      );\r\n\r\n      const bufferTimeLength =\r\n        (1000 * analyser.frequencyBinCount) / audioContext.sampleRate;\r\n      const sampleTick = bufferTimeLength / analyser.frequencyBinCount;\r\n\r\n      canvasCtx.clearRect(0, 0, canvas.width, canvas.height);\r\n      canvasCtx.fillStyle = \"rgb(200 200 200)\";\r\n      canvasCtx.fillRect(0, 0, canvas.width, canvas.height);\r\n      canvasCtx.lineWidth = 2;\r\n      canvasCtx.strokeStyle = \"rgb(0 0 0)\";\r\n      canvasCtx.beginPath();\r\n      let x = 0;\r\n      let time = audioNode.history[0][0] - bufferTimeLength;\r\n      for (let i = 0; i < audioNode.history.length; i++) {\r\n        const data = audioNode.history[i][1];\r\n\r\n        for (let j = 0; j < data.length; j++) {\r\n          const v = data[j] / 128.0;\r\n          const y = v * (canvas.height / 2);\r\n\r\n          if (i === 0 && j == 0) {\r\n            canvasCtx.moveTo(canvas.width * x, y);\r\n          } else {\r\n            canvasCtx.lineTo(canvas.width * x, y);\r\n          }\r\n\r\n          x += sampleTick / windowSize;\r\n          time += sampleTick;\r\n          if (time > audioNode.history?.[i + 1]?.[0] - bufferTimeLength) {\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      canvasCtx.stroke();\r\n    }\r\n  }\r\n\r\n  requestAnimationFrame(draw);\r\n}\r\n\r\nfunction nodeCreated(id) {\r\n  const node = editor.getNodeFromId(id);\r\n\r\n  console.log(node.class.toString());\r\n\r\n  console.log(toAudioNodeType.get(node.class.toString()));\r\n  audioNodes[id] = new (toAudioNodeType.get(\r\n    node.class.toString()\r\n  ).prototype.constructor)(audioContext);\r\n\r\n  switch (node.class) {\r\n    case \"o\":\r\n    case \"g\":\r\n    case \"e\":\r\n    case \"f\":\r\n    case \"n\":\r\n      const htmlBody = document\r\n        .getElementById(`node-${id}`)\r\n        .getElementsByClassName(\"drawflow_content_node\")[0].children[0];\r\n      const canvas = document.createElement(\"canvas\");\r\n      canvas.width = 180;\r\n      canvas.height = 180;\r\n      htmlBody.appendChild(canvas);\r\n      const analyser = audioContext.createAnalyser();\r\n      analyser.fftSize = 2048;\r\n      const bufferLength = analyser.frequencyBinCount;\r\n      const dataArray = new Uint8Array(bufferLength);\r\n      analyser.getByteTimeDomainData(dataArray);\r\n\r\n      audioNodes[id].connect(analyser);\r\n\r\n      audioNodes[id].canvas = canvas;\r\n      audioNodes[id].analyser = analyser;\r\n      audioNodes[id].history = [];\r\n    default:\r\n      break;\r\n  }\r\n}\r\n\r\neditor.on(\"nodeCreated\", () => {\r\n  saveTransformedData();\r\n});\r\n\r\neditor.on(\"nodeRemoved\", function (id) {\r\n  saveTransformedData();\r\n  // remove connections\r\n});\r\n\r\neditor.on(\"nodeSelected\", function (id) {});\r\n\r\neditor.on(\"moduleCreated\", function (name) {});\r\n\r\neditor.on(\"moduleChanged\", function (name) {});\r\n\r\neditor.on(\"connectionCreated\", function (connection) {\r\n  const sendingNode = audioNodes[connection.output_id];\r\n  const recievingNode = audioNodes[connection.input_id];\r\n  if (sendingNode && recievingNode) {\r\n    sendingNode.connect(recievingNode.getInput(connection.input_class));\r\n  }\r\n  saveTransformedData();\r\n});\r\n\r\neditor.on(\"connectionRemoved\", function (connection) {\r\n  audioNodes[connection.output_id]?.disconnect(\r\n    audioNodes[connection.input_id].getInput(connection.input_class)\r\n  );\r\n  saveTransformedData();\r\n});\r\n\r\neditor.on(\"mouseMove\", function (position) {\r\n  //\r\n});\r\n\r\neditor.on(\"nodeDataChanged\", function (id) {\r\n  const { data } = editor.getNodeFromId(id);\r\n  console.log(data);\r\n\r\n  audioNodes[id].updateData(data);\r\n  saveTransformedData();\r\n});\r\n\r\neditor.on(\"nodeMoved\", function (id) {});\r\n\r\neditor.on(\"zoom\", function (zoom) {});\r\n\r\neditor.on(\"translate\", function (position) {\r\n  //\r\n});\r\n\r\neditor.on(\"addReroute\", function (id) {});\r\n\r\neditor.on(\"removeReroute\", function (id) {});\r\n\r\n/* DRAG EVENT */\r\n\r\n/* Mouse and Touch Actions */\r\n\r\nvar elements = document.getElementsByClassName(\"drag-drawflow\");\r\nfor (var i = 0; i < elements.length; i++) {\r\n  elements[i].addEventListener(\"touchend\", drop, false);\r\n  elements[i].addEventListener(\"touchmove\", positionMobile, false);\r\n  elements[i].addEventListener(\"touchstart\", drag, false);\r\n}\r\n\r\nvar mobile_item_selec = \"\";\r\nvar mobile_last_move = null;\r\nfunction positionMobile(ev) {\r\n  mobile_last_move = ev;\r\n}\r\n\r\nfunction allowDrop(ev) {\r\n  ev.preventDefault();\r\n}\r\n\r\nfunction drag(ev) {\r\n  if (ev.type === \"touchstart\") {\r\n    mobile_item_selec = ev.target\r\n      .closest(\".drag-drawflow\")\r\n      .getAttribute(\"data-node\");\r\n  } else {\r\n    ev.dataTransfer.setData(\"node\", ev.target.getAttribute(\"data-node\"));\r\n  }\r\n}\r\n\r\nfunction drop(ev) {\r\n  if (ev.type === \"touchend\") {\r\n    var parentdrawflow = document\r\n      .elementFromPoint(\r\n        mobile_last_move.touches[0].clientX,\r\n        mobile_last_move.touches[0].clientY\r\n      )\r\n      .closest(\"#drawflow\");\r\n    if (parentdrawflow != null) {\r\n      addNodeToDrawFlow(\r\n        mobile_item_selec,\r\n        mobile_last_move.touches[0].clientX,\r\n        mobile_last_move.touches[0].clientY\r\n      );\r\n    }\r\n    mobile_item_selec = \"\";\r\n  } else {\r\n    ev.preventDefault();\r\n    var data = ev.dataTransfer.getData(\"node\");\r\n    addNodeToDrawFlow(data, ev.clientX, ev.clientY);\r\n  }\r\n}\r\n\r\nfunction addNodeToDrawFlow(name, pos_x, pos_y, data = null) {\r\n  if (editor.editor_mode === \"fixed\") {\r\n    return null;\r\n  }\r\n  pos_x =\r\n    pos_x *\r\n      (editor.precanvas.clientWidth /\r\n        (editor.precanvas.clientWidth * editor.zoom)) -\r\n    editor.precanvas.getBoundingClientRect().x *\r\n      (editor.precanvas.clientWidth /\r\n        (editor.precanvas.clientWidth * editor.zoom));\r\n  pos_y =\r\n    pos_y *\r\n      (editor.precanvas.clientHeight /\r\n        (editor.precanvas.clientHeight * editor.zoom)) -\r\n    editor.precanvas.getBoundingClientRect().y *\r\n      (editor.precanvas.clientHeight /\r\n        (editor.precanvas.clientHeight * editor.zoom));\r\n  var nodeId = null;\r\n  switch (name) {\r\n    case \"s\":\r\n      var output = `\r\n      <div>\r\n        <div class=\"title-box\"><i class=\"fas fa-volume-up\"></i> Audio Out </div>\r\n      </div>\r\n      `;\r\n      nodeId = editor.addNode(\"s\", 1, 0, pos_x, pos_y, \"s\", data ?? {}, output);\r\n      break;\r\n    case \"g\":\r\n      var gain = `\r\n        <div>\r\n          <div class=\"title-box\"><i class=\"fas fa-at\"></i> Gain</div>\r\n      <div class=\"box\">\r\n        <p>Gain</p>\r\n        <input type=\"number\" df-gain>\r\n      </div>\r\n        </div>\r\n        `;\r\n      nodeId = editor.addNode(\r\n        \"g\",\r\n        2,\r\n        1,\r\n        pos_x,\r\n        pos_y,\r\n        \"g\",\r\n        data ?? { gain: 1 },\r\n        gain\r\n      );\r\n      break;\r\n\r\n    case \"e\":\r\n      var env = `\r\n      <div>\r\n        <div class=\"title-box\"><i class=\"fab fa-telegram-plane\"></i> Envelope</div>\r\n        <div class=\"box\">\r\n          <p>Select type</p>\r\n          <select df-ramptype>\r\n            <option value=\"exp\">Exponential</option>\r\n            <option value=\"linear\">Linear</option>\r\n            <option value=\"instant\">Instant</option>\r\n          </select>\r\n        </div>\r\n        <div class=\"box\">\r\n          <p>Attack</p>\r\n          <input type=\"number\" df-attack>\r\n        </div>\r\n        <div class=\"box\">\r\n          <p>Decay</p>\r\n          <input type=\"number\" df-decay>\r\n        </div>\r\n        <div class=\"box\">\r\n          <p>Peak</p>\r\n          <input type=\"number\" df-peak>\r\n        </div>\r\n      </div>\r\n      `;\r\n      nodeId = editor.addNode(\r\n        \"e\",\r\n        1,\r\n        1,\r\n        pos_x,\r\n        pos_y,\r\n        \"e\",\r\n        data ?? { ramptype: \"exp\", attack: 1, peak: 1, decay: 1 },\r\n        env\r\n      );\r\n      break;\r\n\r\n    case \"n\":\r\n      var noise = `\r\n        <div>\r\n          <div class=\"title-box\"><i class=\"fab fa-telegram-plane\"></i> Noise</div>\r\n          <div class=\"box\">\r\n            <p>Select type</p>\r\n            <select df-type>\r\n              <option value=\"white\">White</option>\r\n              <option value=\"pink\">Pink</option>\r\n              <option value=\"brown\">Brown</option>\r\n            </select>\r\n          </div>\r\n        </div>\r\n        `;\r\n      nodeId = editor.addNode(\r\n        \"n\",\r\n        0,\r\n        1,\r\n        pos_x,\r\n        pos_y,\r\n        \"n\",\r\n        data ?? { type: \"white\" },\r\n        noise\r\n      );\r\n      break;\r\n\r\n    case \"f\":\r\n      var filter = `\r\n      <div>\r\n        <div class=\"title-box\"><i class=\"fab fa-telegram-plane\"></i> Filter</div>\r\n        <div class=\"box\">\r\n          <p>Select type</p>\r\n          <select df-type>\r\n            <option value=\"lowpass\">Low Pass</option>\r\n            <option value=\"highpass\">High Pass</option>\r\n            <option value=\"bandpass\">Band Pass</option>\r\n            <option value=\"lowshelf\">Low Shelf</option>\r\n            <option value=\"peaking\">Peaking</option>\r\n            <option value=\"notch\">Notch</option>\r\n            <option value=\"allpass\">All Pass</option>\r\n          </select>\r\n        </div>\r\n        <div class=\"box\">\r\n          <p>Frequency</p>\r\n          <input type=\"number\" df-frequency>\r\n        </div>\r\n      </div>\r\n      `;\r\n      nodeId = editor.addNode(\r\n        \"f\",\r\n        2,\r\n        1,\r\n        pos_x,\r\n        pos_y,\r\n        \"f\",\r\n        data ?? { type: \"lowpass\", frequency: 200 },\r\n        filter\r\n      );\r\n      break;\r\n\r\n    case \"c\":\r\n      var clk = `\r\n      <div>\r\n        <div class=\"title-box\"><i class=\"fab fa-telegram-plane\"></i> Clock</div>\r\n        <div class=\"box\">\r\n          <p>BPM</p>\r\n          <input type=\"number\" value=60 df-bpm>\r\n        </div>\r\n      </div>\r\n      `;\r\n      nodeId = editor.addNode(\r\n        \"c\",\r\n        0,\r\n        1,\r\n        pos_x,\r\n        pos_y,\r\n        \"c\",\r\n        data ?? { bpm: 60 },\r\n        clk\r\n      );\r\n      break;\r\n\r\n    case \"o\":\r\n      var osc = `\r\n    <div>\r\n      <div class=\"title-box\"><i class=\"fab fa-telegram-plane\"></i> Oscillator</div>\r\n      <div class=\"box\">\r\n        <p>Select type</p>\r\n        <select df-type>\r\n          <option value=\"sine\">Sine</option>\r\n          <option value=\"square\">Square</option>\r\n          <option value=\"sawtooth\">Sawtooth</option>\r\n          <option value=\"triangle\">Triangle</option>\r\n        </select>\r\n      </div>\r\n      <div class=\"box\">\r\n        <p>Frequency</p>\r\n        <input type=\"number\" df-frequency>\r\n      </div>\r\n    </div>\r\n    `;\r\n      nodeId = editor.addNode(\r\n        \"o\",\r\n        1,\r\n        1,\r\n        pos_x,\r\n        pos_y,\r\n        \"o\",\r\n        data ?? { type: \"sine\", frequency: 260 },\r\n        osc\r\n      );\r\n      break;\r\n\r\n    case \"d\":\r\n      var delay = `\r\n      <div>\r\n        <div class=\"title-box\"><i class=\"fab fa-telegram-plane\"></i> Delay</div>\r\n        <div class=\"box\">\r\n          <p>Delay Time</p>\r\n          <input type=\"number\" df-delay>\r\n        </div>\r\n      </div>\r\n      `;\r\n      nodeId = editor.addNode(\r\n        \"d\",\r\n        2,\r\n        1,\r\n        pos_x,\r\n        pos_y,\r\n        \"d\",\r\n        data ?? { delay: 0.2 },\r\n        delay\r\n      );\r\n      break;\r\n\r\n    default:\r\n      return null;\r\n  }\r\n  nodeCreated(nodeId);\r\n  return nodeId;\r\n}\r\n\r\nvar transform = \"\";\r\nfunction showpopup(e) {\r\n  e.target.closest(\".drawflow-node\").style.zIndex = \"9999\";\r\n  e.target.children[0].style.display = \"block\";\r\n  //document.getElementById(\"modalfix\").style.display = \"block\";\r\n\r\n  //e.target.children[0].style.transform = 'translate('+translate.x+'px, '+translate.y+'px)';\r\n  transform = editor.precanvas.style.transform;\r\n  editor.precanvas.style.transform = \"\";\r\n  editor.precanvas.style.left = editor.canvas_x + \"px\";\r\n  editor.precanvas.style.top = editor.canvas_y + \"px\";\r\n\r\n  //e.target.children[0].style.top  =  -editor.canvas_y - editor.container.offsetTop +'px';\r\n  //e.target.children[0].style.left  =  -editor.canvas_x  - editor.container.offsetLeft +'px';\r\n  editor.editor_mode = \"fixed\";\r\n}\r\n\r\nfunction closemodal(e) {\r\n  e.target.closest(\".drawflow-node\").style.zIndex = \"2\";\r\n  e.target.parentElement.parentElement.style.display = \"none\";\r\n  //document.getElementById(\"modalfix\").style.display = \"none\";\r\n  editor.precanvas.style.transform = transform;\r\n  editor.precanvas.style.left = \"0px\";\r\n  editor.precanvas.style.top = \"0px\";\r\n  editor.editor_mode = \"edit\";\r\n}\r\n\r\nfunction changeModule(event) {\r\n  var all = document.querySelectorAll(\".menu ul li\");\r\n  for (var i = 0; i < all.length; i++) {\r\n    all[i].classList.remove(\"selected\");\r\n  }\r\n  event.target.classList.add(\"selected\");\r\n}\r\n\r\nfunction changeMode(option) {\r\n  //\r\n  if (option == \"lock\") {\r\n    lock.style.display = \"none\";\r\n    unlock.style.display = \"block\";\r\n  } else {\r\n    lock.style.display = \"block\";\r\n    unlock.style.display = \"none\";\r\n  }\r\n}\r\n\r\nfunction trigger() {\r\n  for (const [_, audioNode] of Object.entries(audioNodes)) {\r\n    if (audioNode.applyEnvelope) {\r\n      audioNode.applyEnvelope(audioContext.currentTime);\r\n    }\r\n  }\r\n}\r\n\r\nwindow.drop = drop;\r\nwindow.drag = drag;\r\nwindow.allowDrop = allowDrop;\r\nwindow.trigger = trigger;\r\nwindow.editor = editor;\r\n\r\nconst nodeTypes = [\r\n  Output,\r\n  Gain,\r\n  EnvelopeNode,\r\n  NoiseNode,\r\n  BiquadFilter,\r\n  Oscillator,\r\n  ClockNode,\r\n  Delay,\r\n];\r\n\r\ntoAudioNodeType = new Map(\r\n  nodeTypes.map((nodeType) => [nodeType.shortName, nodeType])\r\n);\r\n\r\nconsole.log(toAudioNodeType);\r\n\r\nreadData();\r\nrequestAnimationFrame(draw);\r\n"],"names":["DefaultCompressor","str","base64","DefaultPreprocessor","jsonData","DataManager","compressor","preprocessor","base64UrlStr","url","_EnvelopeNode","audioContext","data","ramptype","peak","attack","decay","key","time","setValue","currentTime","val","t","addStep","deltaTime","__publicField","EnvelopeNode","NoiseNode","bufferSize","noiseBuffer","output","b0","b1","b2","b3","b4","b5","b6","i","white","lastOut","ClockNode","context","minBPM","nextNoteTime","nextNextNoteTime","connection","recievingInput","targetInput","index","_BiquadFilter","type","frequency","BiquadFilter","_Oscillator","Oscillator","Gain","Output","Delay","delay","id","editor","toAudioNodeType","DrawflowPreprocessor","outputs","outputName","connections","shortName","node","shortInputName","outputStr","splitStr","arrayForm","value","name","pos_x","pos_y","outputList","c","x","y","outputListNullable","dataNullable","compressedStr","jsonStr","drawflowData","outputsNullable","dataManager","audioNodes","minifyData","editorData","newData","unminifyData","urlData","saveTransformedData","readData","dataP","connectionsMap","idMap","_","distanceToSink","newDist","connections2","d","countOfDist","dist","newId","addNodeToDrawFlow","connectionList","inputId","inputName","draw","timestamp","audioNode","canvas","analyser","canvasCtx","bufferLength","dataArray","windowSize","bufferTimeLength","sampleTick","j","_b","_a","nodeCreated","htmlBody","sendingNode","recievingNode","position","zoom","elements","drop","positionMobile","drag","mobile_item_selec","mobile_last_move","ev","allowDrop","parentdrawflow","nodeId","gain","env","noise","filter","clk","osc","trigger","nodeTypes","nodeType"],"mappings":"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"}